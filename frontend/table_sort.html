<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refugee Management System - Table Sorting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sortable {
            cursor: pointer;
            position: relative;
            padding-right: 20px;
        }
        .sortable::after {
            content: "";
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            border: 5px solid transparent;
        }
        .sortable.asc::after {
            border-bottom-color: #333;
            margin-top: -3px;
        }
        .sortable.desc::after {
            border-top-color: #333;
            margin-top: 3px;
        }
        .badge-placed { background-color: #28a745; }
        .badge-unplaced { background-color: #ffc107; color: #333; }
        .badge-available { background-color: #17a2b8; }
        .badge-unavailable { background-color: #6c757d; }
        .table-hover tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.05);
        }
        .pagination .page-item.active .page-link {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">Refugee Management System</h2>
                        <p class="mb-0">Click column headers to sort data</p>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover table-striped">
                                <thead>
                                    <tr>
                                        <th class="sortable" data-field="id">ID</th>
                                        <th class="sortable" data-field="full_name">Full Name</th>
                                        <th class="sortable" data-field="date_of_birth">Date of Birth</th>
                                        <th class="sortable" data-field="age">Age</th>
                                        <th class="sortable" data-field="status">Status</th>
                                    </tr>
                                </thead>
                                <tbody id="table-body">
                                    <!-- Table content will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <div class="d-flex align-items-center">
                                <span class="me-2">Items per page:</span>
                                <select class="form-select form-select-sm w-auto" id="per-page">
                                    <option value="5">5</option>
                                    <option value="10" selected>10</option>
                                    <option value="20">20</option>
                                </select>
                            </div>

                            <nav>
                                <ul class="pagination mb-0" id="pagination">
                                    <!-- Pagination will be generated by JavaScript -->
                                </ul>
                            </nav>

                            <div class="text-muted" id="page-info">
                                Showing 0-0 of 0 items
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header bg-light">
                        <h3 class="h6 mb-0">API Request Information</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Current API Request:</label>
                            <div class="alert alert-info p-2 mb-0" id="api-request">
                                GET /api/guest/list?page=1&limit=10
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-3">Backend API Changes</h5>
                                <pre><code>// Updated API endpoint with sorting support
GET /api/{model}/list

// Parameters
page: number    // Page number (default: 1)
limit: number   // Items per page (default: 10)
sort: string    // Sort field and direction (e.g. "full_name:asc")
// OR
sort_field: string   // Sort field
sort_direction: string // "asc" or "desc"</code></pre>
                            </div>
                            <div class="col-md-6">
                                <h5 class="mb-3">Frontend Sorting Logic</h5>
                                <pre><code>// Handle header click
function handleHeaderClick(field) {
  if (currentSortField === field) {
    // Cycle through sorting states
    if (currentSortDirection === 'asc') {
      currentSortDirection = 'desc';
    } else {
      // Reset sorting if already descending
      currentSortField = null;
      currentSortDirection = null;
    }
  } else {
    // New sort field, default to ascending
    currentSortField = field;
    currentSortDirection = 'asc';
  }

  // Reset to first page
  currentPage = 1;

  // Reload data
  loadData();
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock data - in real app, this would come from API
        const mockGuests = [
            {id: 1, full_name: "Peter Quill", date_of_birth: "15-05-1980", status: "placed", age: 43},
            {id: 2, full_name: "Gamora", date_of_birth: "22-11-1985", status: "placed", age: 38},
            {id: 3, full_name: "Drax", date_of_birth: "03-01-1978", status: "placed", age: 45},
            {id: 4, full_name: "Rocket", date_of_birth: "18-07-2010", status: "unplaced", age: 13},
            {id: 5, full_name: "Groot", date_of_birth: "25-12-2015", status: "unplaced", age: 8},
            {id: 6, full_name: "Mantis", date_of_birth: "14-02-1989", status: "placed", age: 34},
            {id: 7, full_name: "Nebula", date_of_birth: "09-08-1987", status: "placed", age: 36},
            {id: 8, full_name: "Yondu Udonta", date_of_birth: "30-04-1965", status: "placed", age: 58},
            {id: 9, full_name: "Kraglin Obfonteri", date_of_birth: "17-03-1982", status: "unplaced", age: 41},
            {id: 10, full_name: "Howard the Duck", date_of_birth: "01-01-1980", status: "unplaced", age: 43},
            {id: 11, full_name: "Valkyrie", date_of_birth: "12-06-1988", status: "placed", age: 35},
            {id: 12, full_name: "Korg", date_of_birth: "23-09-1990", status: "unplaced", age: 33},
            {id: 13, full_name: "Miek", date_of_birth: "05-11-1992", status: "unplaced", age: 31},
            {id: 14, full_name: "Shuri", date_of_birth: "19-07-1998", status: "placed", age: 25},
            {id: 15, full_name: "Okoye", date_of_birth: "28-02-1984", status: "placed", age: 39},
            {id: 16, full_name: "Nakia", date_of_birth: "15-08-1989", status: "placed", age: 34},
            {id: 17, full_name: "M'Baku", date_of_birth: "03-03-1975", status: "placed", age: 48},
            {id: 18, full_name: "Wong", date_of_birth: "22-10-1978", status: "unplaced", age: 45},
            {id: 19, full_name: "Happy Hogan", date_of_birth: "11-09-1970", status: "unplaced", age: 53},
            {id: 20, full_name: "May Parker", date_of_birth: "07-04-1965", status: "placed", age: 58}
        ];

        // Global state
        const state = {
            currentPage: 1,
            itemsPerPage: 10,
            totalItems: mockGuests.length,
            currentSortField: null,
            currentSortDirection: null
        };

        // Initialize the app
        function init() {
            renderTable();
            setupPagination();
            setupEventListeners();
            updateApiRequestDisplay();
        }

        // Render table with current data
        function renderTable() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            const sortedData = sortData([...mockGuests]);
            const paginatedData = paginateData(sortedData);

            paginatedData.forEach(guest => {
                const row = document.createElement('tr');

                // Determine badge class based on status
                let badgeClass = '';
                if (guest.status === 'placed') badgeClass = 'badge-placed';
                else if (guest.status === 'unplaced') badgeClass = 'badge-unplaced';

                row.innerHTML = `
                    <td>${guest.id}</td>
                    <td>${guest.full_name}</td>
                    <td>${guest.date_of_birth}</td>
                    <td>${guest.age}</td>
                    <td><span class="badge ${badgeClass}">${guest.status}</span></td>
                `;

                tbody.appendChild(row);
            });

            updatePageInfo();
            updateSortIndicators();
        }

        // Sort data based on current sort settings
        function sortData(data) {
            if (!state.currentSortField) return data;

            return data.sort((a, b) => {
                let valA = a[state.currentSortField];
                let valB = b[state.currentSortField];

                // Handle different data types
                if (state.currentSortField === 'age' || state.currentSortField === 'id') {
                    valA = Number(valA);
                    valB = Number(valB);
                }

                if (valA < valB) {
                    return state.currentSortDirection === 'asc' ? -1 : 1;
                }
                if (valA > valB) {
                    return state.currentSortDirection === 'asc' ? 1 : -1;
                }
                return 0;
            });
        }

        // Paginate data
        function paginateData(data) {
            const start = (state.currentPage - 1) * state.itemsPerPage;
            const end = start + state.itemsPerPage;
            return data.slice(start, end);
        }

        // Setup pagination controls
        function setupPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(state.totalItems / state.itemsPerPage);

            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${state.currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="prev">&laquo;</a>`;
            pagination.appendChild(prevLi);

            // Page buttons
            const startPage = Math.max(1, state.currentPage - 2);
            const endPage = Math.min(totalPages, startPage + 4);

            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === state.currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                pagination.appendChild(li);
            }

            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${state.currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="next">&raquo;</a>`;
            pagination.appendChild(nextLi);
        }

        // Update page info display
        function updatePageInfo() {
            const start = (state.currentPage - 1) * state.itemsPerPage + 1;
            const end = Math.min(state.currentPage * state.itemsPerPage, state.totalItems);
            document.getElementById('page-info').textContent =
                `Showing ${start}-${end} of ${state.totalItems} items`;
        }

        // Update sort indicators in table headers
        function updateSortIndicators() {
            document.querySelectorAll('.sortable').forEach(header => {
                header.classList.remove('asc', 'desc');

                if (header.dataset.field === state.currentSortField) {
                    header.classList.add(state.currentSortDirection);
                }
            });
        }

        // Update API request display
        function updateApiRequestDisplay() {
            let params = [`page=${state.currentPage}`, `limit=${state.itemsPerPage}`];

            if (state.currentSortField) {
                params.push(`sort=${state.currentSortField}:${state.currentSortDirection}`);
            }

            document.getElementById('api-request').textContent =
                `GET /api/guest/list?${params.join('&')}`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sortable headers
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', () => {
                    const field = header.dataset.field;

                    if (state.currentSortField === field) {
                        // Cycle through sorting states
                        if (state.currentSortDirection === 'asc') {
                            state.currentSortDirection = 'desc';
                        } else {
                            // Reset sorting if already descending
                            state.currentSortField = null;
                            state.currentSortDirection = null;
                        }
                    } else {
                        // New sort field, default to ascending
                        state.currentSortField = field;
                        state.currentSortDirection = 'asc';
                    }

                    // Reset to first page
                    state.currentPage = 1;

                    // Update UI and reload data
                    renderTable();
                    setupPagination();
                    updateApiRequestDisplay();
                });
            });

            // Pagination
            document.getElementById('pagination').addEventListener('click', (e) => {
                e.preventDefault();
                const target = e.target.closest('a');
                if (!target) return;

                const page = target.dataset.page;

                if (page === 'prev' && state.currentPage > 1) {
                    state.currentPage--;
                } else if (page === 'next' && state.currentPage < Math.ceil(state.totalItems / state.itemsPerPage)) {
                    state.currentPage++;
                } else if (!isNaN(parseInt(page))) {
                    state.currentPage = parseInt(page);
                }

                renderTable();
                setupPagination();
                updateApiRequestDisplay();
            });

            // Items per page
            document.getElementById('per-page').addEventListener('change', (e) => {
                state.itemsPerPage = parseInt(e.target.value);
                state.currentPage = 1; // Reset to first page
                renderTable();
                setupPagination();
                updateApiRequestDisplay();
            });
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
